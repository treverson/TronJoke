(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(e,t){},119:function(e,t){},225:function(e,t,n){e.exports=n.p+"static/media/banner.4c3553e3.png"},226:function(e,t,n){},228:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(52),i=n.n(s),o=n(60),c=n(61),l=n(2),u=n.n(l),d=n(9),m=n(53),p=n(54),f=n(62),g=n(55),h=n(63),b=n(3),v=n(56),w=n.n(v),E=n(27),k=(n(89),function(e){var t=e.message,n=t.message,a=t.owner,s=t.timestamp,i=t.tips,o=e.messageID,c=e.featured,l=e.tippable,u=e.requiresTronLink,d=e.onTip;return r.a.createElement("div",{className:"message-wrapper"},r.a.createElement("div",{className:"message"+(l?" tippable":"")+(u?" requiresTronLink":""),onClick:function(){return d(o)}},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"owner"},a),c&&r.a.createElement("div",{className:"star"},"\u2605")),r.a.createElement(E.Scrollbars,{style:{width:330,height:85,marginBottom:6},autoHide:!0},r.a.createElement("div",{className:"body"},n)),r.a.createElement("div",{className:"footer-message"},r.a.createElement("div",{className:"timestamp"},w()(1e3*s).fromNow()),i.count?r.a.createElement("div",{className:"tips"},"\u6253\u8d4f\u603b\u989d",r.a.createElement("strong",null,(i.amount/1e6).toLocaleString()," TRX")):"")))}),x=(n(91),function(e){var t=e.recent,n=e.featured,a=e.currentAddress,s=e.tronLinkInstalled,i=e.onTip,o=n.sort(function(e,n){return t[n].tips.amount-t[e].tips.amount}).map(function(e){return r.a.createElement(k,{message:t[e],featured:!0,key:e,messageID:e,tippable:t[e].owner!==a,requiresTronLink:!s,onTip:i})});return r.a.createElement("div",{className:"messages"},o)}),M=n(57),y=n.n(M),N=(n(93),"https://chrome.google.com/webstore/detail/ibnejdfjmmkpcnlpebklmnkoeoihofec/"),W=r.a.createElement("div",{className:"logo"},r.a.createElement("img",{src:y.a,alt:"TronLink logo"})),T=function(){window.open(N,"_blank")},j=function(e){var t=e.installed;return void 0!==t&&t?r.a.createElement("div",{className:"tronLink hover",onClick:T},r.a.createElement("div",{className:"info"},r.a.createElement("h1",null,"Log in Required"),r.a.createElement("p",null,"\u9700\u8981\u767b\u5f55TronLink.")),W):r.a.createElement("div",{className:"tronLink",onClick:T},r.a.createElement("div",{className:"info"},r.a.createElement("h1",null,"\u9700\u8981\u5b89\u88c5TronLink"),r.a.createElement("p",null,"\u8981\u53d1\u5e16\u6216\u8005\u70b9\u8d5e, \u4f60\u5fc5\u987b\u5b89\u88c5TronLink. TronLink\u662f\u4e00\u4e2a\u6d4f\u89c8\u5668\u6ce2\u573a\u94b1\u5305, \u53ef\u4ee5\u4ece",r.a.createElement("a",{href:N,target:"_blank",rel:"noopener noreferrer"},"Chrome\u5e94\u7528\u5546\u5e97\u4e0b\u8f7d"),". \u5b89\u88c5\u540e, \u9700\u8981\u5237\u65b0\u6b64\u9875\u9762.")),W)},O=n(58),C=n.n(O),I=n(19),L={tronWeb:!1,contract:!1,setTronWeb:function(){var e=Object(d.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.tronWeb=t,e.next=3,t.contract().at("THpH82RJuiZa1oJyFG7QWoZZwbTJuYwnR2");case 3:this.contract=e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),transformMessage:function(e){return{tips:{amount:e.tips,count:e.tippers.toNumber()},owner:this.tronWeb.address.fromHex(e.creator),timestamp:e.time.toNumber(),message:e.message}},fetchMessages:function(){var e=Object(d.a)(u.a.mark(function e(){var t,n,a,r,s,i,o,c=this,l=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=l.length>0&&void 0!==l[0]?l[0]:{},n=l.length>1&&void 0!==l[1]?l[1]:[],a=0;case 3:if(!(a<20)){e.next=13;break}return e.next=6,this.contract.topPosts(a).call();case 6:if(0!==(r=e.sent).toNumber()){e.next=9;break}return e.abrupt("break",13);case 9:n.push(r.toNumber());case 10:a++,e.next=3;break;case 13:return e.next=15,this.contract.current().call();case 15:return s=e.sent.toNumber(),i=Math.max(1,s-30),o=Object(I.a)(new Set(Object(I.a)(new Array(s-i).fill().map(function(e,t){return i+t})).concat(Object(I.a)(n)))),e.next=20,Promise.all(o.map(function(e){return c.contract.messages(e).call()})).then(function(e){return e.forEach(function(e,n){var a=+o[n];t[a]=c.transformMessage(e)})});case 20:return e.abrupt("return",{featured:n,recent:t});case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchMessage:function(){var e=Object(d.a)(u.a.mark(function e(t,n){var a,r,s,i,o,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.recent,r=void 0===a?{}:a,s=n.featured,i=void 0===s?[]:s,e.next=3,this.contract.messages(t).call();case 3:return o=e.sent,c=Object.keys(r).filter(function(e){return!i.includes(e)}).sort(function(e,t){return r[t].timestamp-r[e].timestamp}),r[t]=this.transformMessage(o),c.length>30&&c.splice(0,c.length-30).forEach(function(e){delete r[e]}),e.abrupt("return",{message:r[t],recent:r,featured:i});case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},S=n(10),Z=n.n(S),P=(n(225),n(4)),R=n.n(P),A=(n(226),n(59)),q=n.n(A),B=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(f.a)(this,Object(g.a)(t).call(this,e))).state={tronWeb:{installed:!1,loggedIn:!1},currentMessage:{message:"",loading:!1},messages:{recent:{},featured:[]}},n.onMessageEdit=n.onMessageEdit.bind(Object(b.a)(Object(b.a)(n))),n.onMessageSend=n.onMessageSend.bind(Object(b.a)(Object(b.a)(n))),n.onMessageTip=n.onMessageTip.bind(Object(b.a)(Object(b.a)(n))),n.showZuixin=n.showZuixin.bind(Object(b.a)(Object(b.a)(n))),n.showZuire=n.showZuire.bind(Object(b.a)(Object(b.a)(n))),n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark(function e(){var t=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e){var n={installed:!!window.tronWeb,loggedIn:window.tronWeb&&window.tronWeb.ready};if(n.installed)return t.setState({tronWeb:n}),e();var a=0,r=setInterval(function(){if(a>=10){return window.tronWeb=new C.a("https://api.trongrid.io","https://api.trongrid.io","https://api.trongrid.io"),t.setState({tronWeb:{installed:!1,loggedIn:!1}}),clearInterval(r),e()}return n.installed=!!window.tronWeb,n.loggedIn=window.tronWeb&&window.tronWeb.ready,n.installed?(clearInterval(r),e()):a++},1e3)});case 2:return this.state.tronWeb.loggedIn||(window.tronWeb.defaultAddress={hex:window.tronWeb.address.toHex("TWiWt5SEDzaEqS6kE5gandWMNfxR2B5xzg"),base58:"TWiWt5SEDzaEqS6kE5gandWMNfxR2B5xzg"},window.tronWeb.on("addressChanged",function(){t.state.tronWeb.loggedIn||t.setState({tronWeb:{installed:!0,loggedIn:!0}})})),e.next=5,L.setTronWeb(window.tronWeb);case 5:this.startEventListener(),this.fetchMessages();case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"startEventListener",value:function(){var e=this;L.contract.MessagePosted().watch(function(t,n){var a=n.result;if(t)return console.error("Failed to bind event listener:",t);console.log("Detected new message:",a.id),e.fetchMessage(+a.id)})}},{key:"fetchMessages",value:function(){var e=Object(d.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,L.fetchMessages();case 3:e.t1=e.sent,e.t2={messages:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchMessage",value:function(){var e=Object(d.a)(u.a.mark(function e(t){var n,a,r,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.fetchMessage(t,this.state.messages);case 2:return n=e.sent,a=n.recent,r=n.featured,s=n.message,this.setState({messages:{recent:a,featured:r}}),e.abrupt("return",s);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onMessageEdit",value:function(e){var t=e.target.value;this.state.currentMessage.loading||this.setState({currentMessage:{message:t,loading:!1}})}},{key:"onMessageSend",value:function(){var e=this,t=this.state.currentMessage,n=t.loading,a=t.message;n||a.trim().length&&(this.setState({currentMessage:{loading:!0,message:a}}),L.contract.postMessage(a).send({shouldPollResponse:!0,callValue:1e7}).then(function(e){return Z()({title:"Post Created",type:"success"})}).catch(function(e){return Z()({title:"Post Failed",type:"error"})}).then(function(){e.setState({currentMessage:{loading:!1,message:a}})}))}},{key:"onMessageTip",value:function(){var e=Object(d.a)(u.a.mark(function e(t){var n,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Object(c.a)({},this.state.messages.recent,this.state.messages.featured)).hasOwnProperty(t)){e.next=3;break}return e.abrupt("return");case 3:if(this.state.tronWeb.loggedIn){e.next=5;break}return e.abrupt("return");case 5:if(n[t].owner!==L.tronWeb.defaultAddress.base58){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,Z()({title:"Tip Message",text:"Enter tip amount in TRX",confirmButtonText:"Tip",input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,allowOutsideClick:function(){return!Z.a.isLoading()},allowEscapeKey:function(){return!Z.a.isLoading()},preConfirm:function(e){return isNaN(e)||e<=0?(Z.a.showValidationMessage("Invalid tip amount provided"),!1):L.contract.tipMessage(+t).send({callValue:1e6*Number(e)}).then(function(){return!0}).catch(function(e){Z.a.showValidationMessage(e)})}});case 9:a=e.sent,a.value&&Z()({title:"Message Tipped",type:"success"});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderMessageInput",value:function(){return this.state.tronWeb.installed?this.state.tronWeb.loggedIn?r.a.createElement("div",{className:"messageInput"+(this.state.currentMessage.loading?" loading":"")},r.a.createElement("textarea",{placeholder:"\u6bb5\u53cb\u51fa\u5f81, \u5bf8\u8349\u4e0d\u751f",value:this.state.currentMessage.message,onChange:this.onMessageEdit}),r.a.createElement("div",{className:"footerx"},r.a.createElement("div",{className:"warning"},"\u53d1\u5e16\u8d39\u752810TRX"),r.a.createElement("div",{className:"button is-success",onClick:this.onMessageSend}," \u53d1\u5e16 "))):r.a.createElement(j,{installed:!0}):r.a.createElement(j,null)}},{key:"showZuixin",value:function(){R()("#tab-all").addClass("is-active"),R()("#tab-all").addClass("active"),R()("#tab-my").removeClass("is-active"),R()("#tab-my").removeClass("active"),R()("#all-content").show(),R()("#my-content").hide()}},{key:"showZuire",value:function(){R()("#tab-my").addClass("is-active"),R()("#tab-my").addClass("active"),R()("#tab-all").removeClass("is-active"),R()("#tab-all").removeClass("active"),R()("#my-content").show(),R()("#all-content").hide()}},{key:"render",value:function(){var e=this,t=this.state.messages,n=t.recent,a=t.featured,s=Object.entries(n).sort(function(e,t){return t[1].timestamp-e[1].timestamp}).map(function(t){var n=Object(o.a)(t,2),s=n[0],i=n[1];return r.a.createElement(k,{message:i,featured:a.includes(+s),key:s,messageID:s,tippable:i.owner!==L.tronWeb.defaultAddress.base58,requiresTronLink:!e.state.tronWeb.installed,onTip:e.onMessageTip})});return r.a.createElement("div",null,r.a.createElement("div",{className:"kontainer"},r.a.createElement("div",{className:"header white"},r.a.createElement("img",{src:q.a}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce2\u573a\u6bb5\u5b50")," \u662f\u4e00\u4e2a\u53ef\u4ee5\u628a\u4f60\u559c\u6b22\u7684\u6bb5\u5b50\u53d1\u4e0a\u6765, \u5e76\u83b7\u5f97\u6253\u8d4f\u7684\u7f51\u7ad9\u3002 \u6bcf\u5929\u7684\u6253\u8d4f\u7b2c\u4e00\u540d\u90fd\u5c06\u83b7\u5f971000Trx\u5956\u52b1\u3002",r.a.createElement("br",null),r.a.createElement("br",null),"\u671f\u5f85\u4f60\u7684\u8868\u6f14~")),this.renderMessageInput(),r.a.createElement("div",{className:"tabs"},r.a.createElement("ul",null,r.a.createElement("li",{className:"is-active",id:"tab-all",onClick:this.showZuixin},r.a.createElement("a",null,"\u6700\u65b0")),r.a.createElement("li",{id:"tab-my",className:"has-text-black",onClick:this.showZuire},r.a.createElement("a",null,"\u6700\u70ed")))),r.a.createElement("div",{id:"my-content"},r.a.createElement("div",{className:"header"},r.a.createElement("span",null,"\u6309\u6253\u8d4f\u6392\u5e8ftop20")),r.a.createElement(x,{recent:n,featured:a,currentAddress:L.tronWeb&&L.tronWeb.defaultAddress.base58,tronLinkInstalled:this.state.tronWeb.installed,onTip:this.onMessageTip})),r.a.createElement("div",{id:"all-content"},r.a.createElement("div",{className:"header"},r.a.createElement("span",null,"\u70b9\u51fb\u5e16\u5b50, \u53ef\u4ee5\u6253\u8d4f")),r.a.createElement("div",{className:"messages"},s))),r.a.createElement("footer",{class:"footer"},r.a.createElement("div",{class:"container"},r.a.createElement("div",{class:"content has-text-centered"},r.a.createElement("p",null,r.a.createElement("small",null,"All rights reserved. ",r.a.createElement("br",null),"\xa9 Copyright 2018",r.a.createElement("strong",null,"\xa0\xa0tronjoke.me"))),r.a.createElement("p",null," Powered by ydapp.io ")))))}}]),t}(r.a.Component);i.a.render(r.a.createElement(B,null),document.getElementById("root"))},57:function(e,t,n){e.exports=n.p+"static/media/TronLinkLogo.d3a8f115.png"},59:function(e,t,n){e.exports=n.p+"static/media/tronjoke.a6683f35.png"},64:function(e,t,n){e.exports=n(228)},89:function(e,t,n){},91:function(e,t,n){},93:function(e,t,n){}},[[64,2,1]]]);
//# sourceMappingURL=main.4d9b4dc9.chunk.js.map